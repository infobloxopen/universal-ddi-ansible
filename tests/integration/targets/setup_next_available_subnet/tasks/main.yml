---
- module_defaults:
    group/infoblox.universal_ddi.all:
      portal_url: "{{ portal_url }}"
      portal_key: "{{ portal_key }}"
  block:

    - name: "Create an Address Block with tags"
      infoblox.universal_ddi.ipam_address_block:
        address: "192.168.0.0/27"
        space: "{{ _ip_space.id }}"
        tags:
          environment: "test"
          location: "site-1"
        state: "present"
      register: _tagged_address_block

    - name: "Create a second Address Block with the same tags but smaller capacity"
      infoblox.universal_ddi.ipam_address_block:
        address: "172.16.0.0/27"
        space: "{{ _ip_space.id }}"
        tags:
          environment: "test"
          location: "site-1"
        state: "present"
      register: _small_tagged_address_block

    # Creating address blocks to test the continuity of the next available subnet search to other address blocks if the current has a larger CIDR than the requested one.
    - name: "Create Address Block 1"
      infoblox.universal_ddi.ipam_address_block:
        address: "15.0.0.0/28"
        space: "{{ _ip_space.id }}"
        tags:
          environment: "test-2"
          location: "site-2"
        state: "present"

    - name: "Create Address Block 2"
      infoblox.universal_ddi.ipam_address_block:
        address: "20.0.0.0/25"
        space: "{{ _ip_space.id }}"
        tags:
          environment: "test-2"
          location: "site-2"
        state: "present"

    - name: "Create Address Block 3"
      infoblox.universal_ddi.ipam_address_block:
        address: "30.0.0.0/27"
        space: "{{ _ip_space.id }}"
        tags:
          environment: "test-2"
          location: "site-2"
        state: "present"

    - name: "Create Address Block 4"
      infoblox.universal_ddi.ipam_address_block:
        address: "40.0.0.0/15"
        space: "{{ _ip_space.id }}"
        tags:
          environment: "test-2"
          location: "site-2"
        state: "present"
